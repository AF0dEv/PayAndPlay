@using System.Globalization
<h1>Perfil de @Context.Session.GetString("UTILIZADOR")</h1>

<div>
    <h2>Listagens</h2>
    <form method="post" action="@Url.Action("Index", "PerfilUser")">
        @Html.RadioButton("rbtEscolha", 1, ViewBag.RBTESCOLHA == 1, new { onclick = "this.form.submit()" }) <label>Gastos Por Mês</label>
        @Html.RadioButton("rbtEscolha", 2, ViewBag.RBTESCOLHA == 2, new { onclick = "this.form.submit()" }) <label>Gastos Por Periodo</label>
    </form>
</div>

<div>
    
    @{
        @if (ViewBag.MESES == true)
        {
            <form method="post" action="@Url.Action("MostrarGastosMes", "PerfilUser")">
                <label for="month">Selecione Mês:</label>
                <br />
                <select id="month" name="month" onchange="this.form.submit()">
                    @for (Int16 i = 0; i < 12; i++)
                    {
                        if (ViewBag.month == i)
                        {
                            <option value="@i" selected>@DateTimeFormatInfo.InvariantInfo.MonthNames[i]</option>
                        }
                        else
                        {
                            <option value="@i">@DateTimeFormatInfo.InvariantInfo.MonthNames[i]</option>
                        }
                    }
                </select>
            </form>
        }
        else if (ViewBag.PERIODO == true)
        {
            <form method="post" action="@Url.Action("MostrarGastosPeriodo", "PerfilUser")">
                <label for="monthBegin">Selecione o Mês Inicial:</label>
                <br />
                <select id="monthBegin" name="monthBegin">
                    @for (Int16 i = 0; i < 12; i++)
                    {
                        if (ViewBag.monthBegin == i)
                        {
                            <option value="@i" selected>@DateTimeFormatInfo.InvariantInfo.MonthNames[i]</option>
                        }
                        else
                        {
                            <option value="@i">@DateTimeFormatInfo.InvariantInfo.MonthNames[i]</option>
                        }
                    }
                </select>
                <br />
                <label for="monthEnd">Selecione o Mês Final:</label>
                <br />
                <select id="monthEnd" name="monthEnd">
                    @for (Int16 i = 0; i < 12; i++)
                    {
                        if (ViewBag.monthEnd == i)
                        {
                            <option value="@i" selected>@DateTimeFormatInfo.InvariantInfo.MonthNames[i]</option>
                        }
                        else
                        {
                            <option value="@i">@DateTimeFormatInfo.InvariantInfo.MonthNames[i]</option>
                        }
                    }
                </select>
                <div class="form-group">
                    <input type="submit" value="Procurar" class="btn btn-primary" />
                </div>
            </form>
        }
    }
</div>

@{
    <div>
    @if (ViewBag.GASTOSMES != null){
            <canvas id="MonthChart"></canvas>
        }else if (ViewBag.GASTOSPERIODO != null)
        {
            <canvas id="PeriodChart"></canvas>
        }
    </div>
}

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    var ctx = document.getElementById('MonthChart').getContext('2d');
    var data = @Html.Raw(Json.Serialize(ViewBag.GASTOSMES));
    var labels = Object.keys(data);
    var values = Object.values(data);

    var myChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: 'Total Spent in Selected Month',
                data: values,
                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
</script>
<script>
    var ctxPeriod = document.getElementById('PeriodChart').getContext('2d');
    var dataPeriod = @Html.Raw(Json.Serialize(ViewBag.GASTOSPERIODO));
    var labelsPeriod = Object.keys(dataPeriod);
    var valuesPeriod = Object.values(dataPeriod);

    var myChartPeriod = new Chart(ctxPeriod, {
        type: 'bar',
        data: {
            labels: labelsPeriod,
            datasets: [{
                label: 'Total Spent in Selected Period',
                data: valuesPeriod,
                backgroundColor: 'rgba(153, 102, 255, 0.2)',
                borderColor: 'rgba(153, 102, 255, 1)',
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
</script>




